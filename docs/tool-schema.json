{
  "name": "pivota_shopping_tool",
  "version": "1.0",
  "description": "Unified shopping tool backed by Pivota, ACP, and AP2. Use it for product search, order creation, payments, order tracking, and after-sales. Version 1.0 - Reference implementation for LLM integrations.",
  "parameters": {
    "type": "object",
    "properties": {
      "operation": {
        "type": "string",
        "description": "Which shopping operation to perform.",
        "enum": [
          "find_products",
          "find_products_multi",
          "get_product_detail",
          "offers.resolve",
          "preview_quote",
          "create_order",
          "submit_payment",
          "get_order_status",
          "request_after_sales",
          "track_product_click"
        ]
      },
      "payload": {
        "type": "object",
        "description": "Operation-specific payload plus opaque ACP/AP2 state.",
        "properties": {
          "acp_state": {
            "type": "object",
            "description": "Opaque ACP state returned from previous calls. Always pass through unchanged.",
            "additionalProperties": true
          },
          "ap2_state": {
            "type": "object",
            "description": "Opaque AP2 state / payment mandate context. Always pass through unchanged.",
            "additionalProperties": true
          },
          "search": {
            "type": "object",
            "description": "Used when operation = find_products or find_products_multi",
            "properties": {
              "merchant_id": { "type": "string", "description": "Optional: specific merchant to search. Omit to search all merchants." },
              "query": { "type": "string", "description": "Natural language description of what the user wants to buy." },
              "price_min": { "type": "number" },
              "price_max": { "type": "number" },
              "currency": { "type": "string", "description": "ISO currency code, e.g. CNY, USD, EUR." },
              "category": { "type": "string", "description": "Product category filter" },
              "in_stock_only": { "type": "boolean", "description": "Filter for in-stock items only. Default: true" },
              "page": { "type": "integer", "minimum": 1 },
              "page_size": { "type": "integer", "minimum": 1, "maximum": 50 }
            },
            "additionalProperties": true
          },
          "product": {
            "type": "object",
            "description": "Used when operation = get_product_detail",
            "properties": {
              "product_id": { "type": "string" },
              "sku_id": { "type": "string" }
            },
            "additionalProperties": true
          },
          "offers": {
            "type": "object",
            "description": "Used when operation = offers.resolve",
            "properties": {
              "product": {
                "type": "object",
                "properties": {
                  "product_id": { "type": "string" },
                  "sku_id": { "type": "string" }
                },
                "additionalProperties": true
              },
              "limit": { "type": "integer", "minimum": 1, "maximum": 30 },
              "market": { "type": "string", "description": "e.g. US" },
              "tool": { "type": "string", "description": "e.g. *" }
            },
            "additionalProperties": true
          },
          "order": {
            "type": "object",
            "description": "Used when operation = create_order",
            "properties": {
              "quote_id": { "type": "string", "description": "Required when quote-first is enabled upstream." },
              "discount_codes": { "type": "array", "items": { "type": "string" } },
              "items": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "product_id": { "type": "string" },
                    "sku_id": { "type": "string" },
                    "variant_id": { "type": "string" },
                    "quantity": { "type": "integer", "minimum": 1 }
                  },
                  "required": ["sku_id", "quantity"],
                  "additionalProperties": true
                }
              },
              "shipping_address": {
                "type": "object",
                "properties": {
                  "country": { "type": "string" },
                  "city": { "type": "string" },
                  "postal_code": { "type": "string" },
                  "address_line1": { "type": "string" },
                  "address_line2": { "type": "string" },
                  "recipient_name": { "type": "string" },
                  "phone": { "type": "string" }
                },
                "required": ["country", "city", "address_line1", "recipient_name"],
                "additionalProperties": true
              },
              "delivery_preferences": {
                "type": "object",
                "properties": {
                  "max_eta_days": { "type": "integer", "minimum": 1 },
                  "preferred_carriers": {
                    "type": "array",
                    "items": { "type": "string" }
                  }
                },
                "additionalProperties": true
              },
              "notes": { "type": "string" }
            },
            "additionalProperties": true
          },
          "quote": {
            "type": "object",
            "description": "Used when operation = preview_quote (quote-first locked pricing)",
            "properties": {
              "merchant_id": { "type": "string" },
              "items": {
                "type": "array",
                "items": {
                  "type": "object",
                  "properties": {
                    "product_id": { "type": "string" },
                    "variant_id": { "type": "string" },
                    "quantity": { "type": "integer", "minimum": 1 }
                  },
                  "required": ["product_id", "quantity"],
                  "additionalProperties": true
                }
              },
              "discount_codes": { "type": "array", "items": { "type": "string" } },
              "customer_email": { "type": "string" },
              "shipping_address": {
                "type": "object",
                "properties": {
                  "country": { "type": "string" },
                  "postal_code": { "type": "string" },
                  "city": { "type": "string" },
                  "state": { "type": "string" }
                },
                "required": ["country", "postal_code"],
                "additionalProperties": true
              }
            },
            "required": ["merchant_id", "items"],
            "additionalProperties": true
          },
          "payment": {
            "type": "object",
            "description": "Used when operation = submit_payment",
            "properties": {
              "order_id": { "type": "string" },
              "expected_amount": { "type": "number" },
              "currency": { "type": "string" },
              "payment_method_hint": {
                "type": "string",
                "description": "Optional hint like 'card', 'wallet', 'bank_transfer', 'pay_later'."
              },
              "return_url": {
                "type": "string",
                "description": "Where to redirect the user back after AP2 auth, if applicable."
              }
            },
            "required": ["order_id", "expected_amount", "currency"],
            "additionalProperties": true
          },
          "status": {
            "type": "object",
            "description": "Used when operation = get_order_status or request_after_sales.",
            "properties": {
              "order_id": { "type": "string" },
              "reason": { "type": "string" },
              "requested_action": {
                "type": "string",
                "enum": ["refund", "return", "exchange", "support"]
              }
            },
            "additionalProperties": true
          }
        },
        "additionalProperties": true
      }
    },
    "required": ["operation", "payload"],
    "additionalProperties": false
  }
}
